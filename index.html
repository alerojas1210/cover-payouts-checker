<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cover Payouts Checker</title>

<style>
body { font-family: Arial, sans-serif; padding: 20px; }
textarea { width: 100%; height: 180px; }
button { margin: 10px 5px; padding: 8px 16px; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: right; }
th { background: #000; color: #fff; }

.green { background: #ccffcc; }
.yellow { background: #fff3b0; }
.red { background: #ffb3b3; }

.status { font-weight: bold; margin-top: 15px; }
</style>
</head>

<body>

<h2>Cover Payouts Checker</h2>

<p>Paste transaction rows below (NO headers):</p>
<textarea id="input"></textarea><br>

<button onclick="analyze()">Analyze</button>
<button onclick="clearAll()">Clear</button>

<div id="status" class="status"></div>
<div id="output"></div>

<script>
function analyze() {

    const lines = document.getElementById("input").value.trim().split("\n");
    let rows = [];

    let activeDebt = 0;

    for (let line of lines) {

        const p = line.trim().split(/\s+/);
        if (p.length < 9) continue;

        const credit = parseFloat(p[6]) || 0;
        const debit  = parseFloat(p[7]) || 0;
        const total  = parseFloat(p[8]) || 0;

        let surplus = "";
        let rowClass = "green";

        // üî¥ PAYOUT
        if (debit > 0) {
            activeDebt += debit;
            rowClass = "red";
        }

        // üü¢ DEPOSIT
        if (credit > 0 && activeDebt > 0) {
            activeDebt -= credit;

            if (activeDebt <= 0) {
                surplus = Math.abs(activeDebt).toFixed(2);
                activeDebt = 0;
                rowClass = "yellow";
            } else {
                rowClass = "red";
            }
        }

        rows.push({
            doc: p[0],
            date: p[1] + " " + p[2],
            type: p[3],
            desc: p[4],
            entered: p[5],
            credit: credit,
            debit: debit,
            total: total,
            surplus: surplus,
            cls: rowClass
        });
    }

    render(rows, activeDebt);
}

function render(rows, activeDebt) {

    let html = `<table><tr>
        <th>Document Number</th>
        <th>TranDateTime</th>
        <th>TranType</th>
        <th>Description</th>
        <th>EnteredBy</th>
        <th>CreditedAmount</th>
        <th>DebitAmount</th>
        <th>TotalAmount</th>
        <th>Surplus After Cover</th>
    </tr>`;

    for (let r of rows) {
        html += `<tr class="${r.cls}">
            <td>${r.doc}</td>
            <td>${r.date}</td>
            <td>${r.type}</td>
            <td>${r.desc}</td>
            <td>${r.entered}</td>
            <td>${r.credit.toFixed(2)}</td>
            <td>${r.debit.toFixed(2)}</td>
            <td>${r.total.toFixed(2)}</td>
            <td>${r.surplus}</td>
        </tr>`;
    }

    html += "</table>";
    document.getElementById("output").innerHTML = html;

    document.getElementById("status").innerHTML =
        activeDebt > 0
        ? `‚ùå Payouts NOT covered ‚Äî Pending: $${activeDebt.toFixed(2)}`
        : `‚úÖ GOOD TO GO ‚Äî All payouts covered`;
}

function clearAll() {
    document.getElementById("input").value = "";
    document.getElementById("output").innerHTML = "";
    document.getElementById("status").innerHTML = "";
}
</script>

</body>
</html>
