<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cover Payouts Checker</title>
<style>
body { font-family: Arial, sans-serif; padding:20px }
textarea { width:100%; height:180px }
button { margin:10px 5px; padding:6px 12px }
table { border-collapse: collapse; width:100%; margin-top:15px }
th, td { border:1px solid #ccc; padding:4px; font-size:12px; text-align:right }
th { background:#000; color:#fff }
.green { background:#c6f7c6 }
.red { background:#f7c6c6 }
.yellow { background:#fff3b0 }
.status-good { color:green; font-weight:bold }
.status-bad { color:red; font-weight:bold }
.left { text-align:left }
</style>
</head>

<body>

<h2>Cover Payouts Checker</h2>

<textarea id="input" placeholder="Paste rows here (NO headers)"></textarea><br>

<button onclick="analyze()">Analyze</button>
<button onclick="clearAll()">Clear</button>

<h3 id="status"></h3>

<table id="resultTable" style="display:none">
<thead>
<tr>
<th>Document Number</th>
<th>TranDateTime</th>
<th>TranType</th>
<th>Description</th>
<th>EnteredBy</th>
<th>CreditedAmount</th>
<th>DebitAmount</th>
<th>TotalAmount</th>
<th>Surplus After Cover</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
function parseLine(line) {
  const parts = line.trim().split(/\s+/);
  if (parts.length < 8) return null;

  const total = parseFloat(parts.pop()) || 0;
  const debit = parseFloat(parts.pop()) || 0;
  const credit = parseFloat(parts.pop()) || 0;

  const doc = parts.shift();
  const dateStr = parts.shift() + " " + parts.shift();
  const type = parts.shift();

  const enteredBy = parts.pop();
  const description = parts.join(" ");

  return {
    doc, dateStr, type, description, enteredBy,
    credit, debit, total
  };
}

function analyze() {
  const text = document.getElementById("input").value.trim();
  if (!text) return;

  const lines = text.split("\n");
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  let debt = 0;

  lines.forEach(line => {
    const r = parseLine(line);
    if (!r) return;

    let surplus = "";
    let coveredHere = false;

    // ðŸ”´ PAYOUT â†’ SIEMPRE ACUMULA SI HAY DEUDA
    if (r.debit < 0) {
      debt += Math.abs(r.debit);
    }

    // ðŸŸ¢ DEPOSIT â†’ cubre deuda existente
    if (r.credit > 0 && debt > 0) {
      if (r.credit >= debt) {
        surplus = (r.credit - debt).toFixed(2);
        debt = 0;
        coveredHere = true;
      } else {
        debt -= r.credit;
      }
    }

    // ðŸŽ¨ COLOR FINAL SEGÃšN DEUDA REAL
    let cls = "green";
    if (coveredHere) {
      cls = "yellow";
    } else if (debt > 0) {
      cls = "red";
    }

    const tr = document.createElement("tr");
    tr.className = cls;
    tr.innerHTML = `
      <td>${r.doc}</td>
      <td>${r.dateStr}</td>
      <td>${r.type}</td>
      <td class="left">${r.description}</td>
      <td>${r.enteredBy}</td>
      <td>${r.credit.toFixed(2)}</td>
      <td>${r.debit.toFixed(2)}</td>
      <td>${r.total.toFixed(2)}</td>
      <td>${surplus}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("resultTable").style.display = "table";

  const status = document.getElementById("status");
  if (debt === 0) {
    status.textContent = "GOOD TO GO â€“ All payouts covered";
    status.className = "status-good";
  } else {
    status.textContent = "UNCOVERED PAYOUTS â€“ Still owed: $" + debt.toFixed(2);
    status.className = "status-bad";
  }
}

function clearAll() {
  document.getElementById("input").value = "";
  document.getElementById("resultTable").style.display = "none";
  document.getElementById("status").textContent = "";
}
</script>

</body>
</html>
