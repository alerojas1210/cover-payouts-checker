
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cover Payouts Checker</title>
<style>
body { font-family: Arial, sans-serif; padding:20px }
textarea { width:100%; height:180px }
button { margin:10px 5px; padding:6px 12px }
table { border-collapse: collapse; width:100%; margin-top:15px }
th, td { border:1px solid #ccc; padding:4px; font-size:12px; text-align:right }
th { background:#000; color:#fff }
.green { background:#c6f7c6 }
.red { background:#f7c6c6 }
.yellow { background:#fff3b0 }
.status-good { color:green; font-weight:bold }
.status-bad { color:red; font-weight:bold }
td.left { text-align:left }
</style>
</head>

<body>

<h2>Cover Payouts Checker</h2>

<textarea id="input" placeholder="Paste rows here (NO headers)"></textarea><br>

<button onclick="analyze()">Analyze</button>
<button onclick="clearAll()">Clear</button>

<h3 id="status"></h3>

<table id="resultTable" style="display:none">
<thead>
<tr>
<th>Document Number</th>
<th>TranDateTime</th>
<th>TranType</th>
<th>Description</th>
<th>EnteredBy</th>
<th>CreditedAmount</th>
<th>DebitAmount</th>
<th>TotalAmount</th>
<th>Surplus After Cover</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
function parseLine(line) {
  // Divide por espacios múltiples
  const parts = line.trim().split(/\s+/);

  if (parts.length < 8) return null;

  return {
    doc: parts[0],
    date: parts[1] + " " + parts[2],
    type: parts[3],
    desc: parts[4],
    entered: parts[5],
    credit: parseFloat(parts[6]) || 0,
    debit: parseFloat(parts[7]) || 0,
    total: parseFloat(parts[8]) || 0
  };
}

function analyze() {
  const text = document.getElementById("input").value.trim();
  if (!text) return;

  const lines = text.split("\n");
  const rows = [];

  for (let l of lines) {
    const r = parseLine(l);
    if (r) rows.push(r);
  }

  // Ordenar de más viejo a más nuevo
  rows.reverse();

  let debt = 0;
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  rows.forEach(r => {
    let cls = "green";
    let surplus = "";

    // PAYOUT
    if (r.debit > 0) {
      debt += r.debit;
      cls = "red";
    }

    // DEPOSIT
    if (r.credit > 0) {
      if (debt > 0) {
        if (r.credit >= debt) {
          surplus = (r.credit - debt).toFixed(2);
          debt = 0;
          cls = "yellow";
        } else {
          debt -= r.credit;
          cls = "red";
        }
      }
    }

    const tr = document.createElement("tr");
    tr.className = cls;

    tr.innerHTML = `
      <td>${r.doc}</td>
      <td>${r.date}</td>
      <td>${r.type}</td>
      <td class="left">${r.desc}</td>
      <td>${r.entered}</td>
      <td>${r.credit.toFixed(2)}</td>
      <td>${r.debit.toFixed(2)}</td>
      <td>${r.total.toFixed(2)}</td>
      <td>${surplus}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("resultTable").style.display = "table";

  const status = document.getElementById("status");
  if (debt === 0) {
    status.textContent = "GOOD TO GO – All payouts covered";
    status.className = "status-good";
  } else {
    status.textContent = "UNCOVERED PAYOUTS – Still owed: $" + debt.toFixed(2);
    status.className = "status-bad";
  }
}

function clearAll() {
  document.getElementById("input").value = "";
  document.getElementById("resultTable").style.display = "none";
  document.getElementById("status").textContent = "";
}
</script>

</body>
</html>
