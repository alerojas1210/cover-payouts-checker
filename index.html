<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cover Payouts Checker</title>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
}
textarea {
    width: 100%;
    height: 180px;
}
button {
    margin: 10px 5px;
    padding: 8px 16px;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: right;
}
th {
    background: #000;
    color: #fff;
}
.green { background: #ccffcc; }
.yellow { background: #fff3b0; }
.red { background: #ffb3b3; }
.status {
    font-weight: bold;
    margin-top: 15px;
}
</style>
</head>

<body>

<h2>Cover Payouts Checker</h2>

<p>Paste transaction rows below (NO headers):</p>
<textarea id="input"></textarea><br>

<button onclick="analyze()">Analyze</button>
<button onclick="clearAll()">Clear</button>

<div id="status" class="status"></div>
<div id="output"></div>

<script>
function analyze() {

    const lines = document.getElementById("input").value.trim().split("\n");
    let rows = [];
    let payoutDebt = 0;

    const headers = [
        "Document Number",
        "TranDateTime",
        "TranType",
        "Description",
        "EnteredBy",
        "CreditedAmount",
        "DebitAmount",
        "TotalAmount",
        "Surplus After Cover"
    ];

    for (let line of lines) {
        const parts = line.trim().split(/\s+/);

        if (parts.length < 8) continue;

        const row = {
            doc: parts[0],
            date: parts[1] + " " + parts[2],
            type: parts[3],
            desc: parts[4],
            entered: parts[5],
            credit: parseFloat(parts[6]) || 0,
            debit: parseFloat(parts[7]) || 0,
            total: parseFloat(parts[8]) || 0,
            surplus: ""
        };

        // üî¥ PAYOUT (Debit)
        if (row.debit > 0) {
            payoutDebt += row.debit;
        }

        // üü¢ DEPOSIT (Credit)
        if (row.credit > 0 && payoutDebt > 0) {
            payoutDebt -= row.credit;

            if (payoutDebt <= 0) {
                row.surplus = Math.abs(payoutDebt).toFixed(2);
                payoutDebt = 0;
            }
        }

        rows.push(row);
    }

    renderTable(rows, payoutDebt);
}

function renderTable(rows, payoutDebt) {

    let html = "<table><tr>";
    for (let h of [
        "Document Number","TranDateTime","TranType","Description",
        "EnteredBy","CreditedAmount","DebitAmount","TotalAmount","Surplus After Cover"
    ]) {
        html += `<th>${h}</th>`;
    }
    html += "</tr>";

    for (let r of rows) {
        let cls = "green";
        if (r.debit > 0 && payoutDebt > 0) cls = "red";
        if (r.surplus !== "") cls = "yellow";

        html += `<tr class="${cls}">
            <td>${r.doc}</td>
            <td>${r.date}</td>
            <td>${r.type}</td>
            <td>${r.desc}</td>
            <td>${r.entered}</td>
            <td>${r.credit.toFixed(2)}</td>
            <td>${r.debit.toFixed(2)}</td>
            <td>${r.total.toFixed(2)}</td>
            <td>${r.surplus}</td>
        </tr>`;
    }

    html += "</table>";
    document.getElementById("output").innerHTML = html;

    document.getElementById("status").innerHTML =
        payoutDebt > 0
        ? `‚ùå Payouts NOT covered ‚Äî Pending: $${payoutDebt.toFixed(2)}`
        : `‚úÖ GOOD TO GO ‚Äî All payouts covered`;
}

function clearAll() {
    document.getElementById("input").value = "";
    document.getElementById("output").innerHTML = "";
    document.getElementById("status").innerHTML = "";
}
</script>

</body>
</html>
